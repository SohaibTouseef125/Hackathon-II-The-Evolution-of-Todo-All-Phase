# Implementation Tasks: Todo AI Chatbot

**Feature**: Todo AI Chatbot
**Spec**: [specs/001-phase3-todo-chatbot/spec.md](./spec.md)
**Plan**: [specs/001-phase3-todo-chatbot/plan.md](./plan.md)
**Created**: 2026-01-12

**Note**: This file is generated by the `/sp.tasks` command. See `.specify/templates/commands/tasks.md` for the execution workflow.

## Task Generation Approach

This task breakdown follows the user stories from the specification, organizing implementation in priority order. Each user story has its own phase with independently testable increments. Tasks follow the checklist format with sequential IDs, story labels where applicable, and specific file paths.

## Dependencies

- User Story 1 (Adding tasks) must be completed before User Story 2 (Viewing tasks)
- User Story 2 must be completed before User Story 3 (Updating tasks)
- User Story 3 must be completed before User Story 4 (Completing tasks)
- User Story 4 must be completed before User Story 5 (Deleting tasks)
- Foundational tasks (database models, authentication) must be completed before any user story

## Parallel Execution Opportunities

- Within each user story: UI components can be developed in parallel with backend services
- MCP tools can be developed in parallel with the agent implementation
- Database models can be developed in parallel with service implementations
- Frontend and backend can be developed in parallel after foundational tasks are complete

## Implementation Strategy

- **MVP Scope**: User Story 1 (Adding tasks) with minimal UI and backend functionality
- **Incremental Delivery**: Complete each user story as a standalone, testable increment
- **Foundational First**: Complete shared infrastructure before user-specific features
- **Test Integration**: Add testing capabilities early in the development process

---

## Phase 1: Project Setup

### Goal
Establish project structure and foundational components required for all user stories.

### Independent Test Criteria
- Project can be initialized and basic server starts
- Database connection can be established
- Authentication system is configured

### Tasks

- [X] T001 Create project directory structure per plan.md
- [X] T002 Initialize backend requirements.txt with FastAPI, SQLModel, Neon DB drivers, OpenAI Agents SDK, Official MCP SDK
- [X] T003 Initialize frontend package.json with Next.js 16+, TypeScript 5+, OpenAI ChatKit dependencies
- [X] T004 Set up basic FastAPI application structure in backend/main.py
- [X] T005 Set up basic Next.js application structure in frontend/src/app/
- [X] T006 Configure environment variables for database and authentication in both backend and frontend

---

## Phase 2: Foundational Components

### Goal
Implement core infrastructure components required by all user stories: database models, authentication, and MCP server foundation.

### Independent Test Criteria
- Database models can be created and queried
- Authentication middleware validates JWT tokens
- MCP server can be started and accepts connections

### Tasks

- [ ] T010 Create database models for Task, Conversation, and Message entities in backend/models.py
- [ ] T011 Implement database connection utilities in backend/db.py
- [ ] T012 Create Pydantic schemas for request/response validation in backend/schemas/
- [ ] T013 Implement JWT authentication middleware in backend/auth.py
- [X] T014 [P] Set up MCP server foundation in backend/mcp_server/server.py
- [X] T015 [P] Create initial MCP tools structure in backend/mcp_server/tools.py
- [ ] T016 [P] Implement basic agent orchestrator in backend/agents/chat_agent.py
- [ ] T017 [P] Create agent runner in backend/agents/runner.py
- [ ] T018 [P] Set up database migration configuration with Alembic
- [ ] T019 Implement database service layer for task operations in backend/services/task_service.py
- [ ] T020 Implement database service layer for conversation operations in backend/services/conversation_service.py
- [ ] T021 Implement database service layer for message operations in backend/services/message_service.py

---

## Phase 3: User Story 1 - Adding Tasks via Natural Language

### Goal
Enable users to add tasks through natural language with the AI assistant using add_task MCP tool.

### User Story
As a user, I can say "Add a task to buy groceries" and the AI assistant will interpret the request, use the add_task MCP tool, and confirm "I've added 'Buy groceries' to your task list"

### Independent Test Criteria
- Natural language input "Add a task to buy groceries" creates a new task in the database
- AI assistant responds with confirmation message
- MCP tool properly validates user authentication
- Task is associated with correct user_id

### Tasks

- [ ] T025 [US1] Implement add_task MCP tool in backend/mcp_server/tools.py
- [ ] T026 [US1] Create chat endpoint for task creation in backend/api/chat.py
- [ ] T027 [US1] Integrate add_task tool with agent in backend/agents/chat_agent.py
- [ ] T028 [US1] Implement task creation service logic in backend/services/task_service.py
- [ ] T029 [US1] Add task creation validation in backend/schemas/task.py
- [ ] T030 [US1] Create basic ChatKit UI for task creation in frontend/src/app/chat/page.tsx
- [ ] T031 [US1] Implement frontend API client for chat endpoint in frontend/src/lib/api.ts
- [ ] T032 [US1] Add authentication handling in frontend for JWT tokens
- [ ] T033 [US1] Test natural language processing for task creation
- [ ] T034 [US1] Test user authentication and authorization for task creation

---

## Phase 4: User Story 2 - Viewing Tasks Through Conversation

### Goal
Enable users to view their tasks through conversation with the AI assistant using list_tasks MCP tool.

### User Story
As a user, I can say "Show me my pending tasks" and the AI assistant will use the list_tasks MCP tool and respond "You have 3 pending tasks: Buy groceries, Call mom, Finish report"

### Independent Test Criteria
- Natural language input "Show me my pending tasks" retrieves appropriate tasks from database
- AI assistant responds with properly formatted list of tasks
- MCP tool properly filters tasks by status
- Only user's own tasks are returned

### Tasks

- [ ] T040 [US2] Implement list_tasks MCP tool in backend/mcp_server/tools.py
- [ ] T041 [US2] Enhance chat endpoint to support task listing in backend/api/chat.py
- [ ] T042 [US2] Integrate list_tasks tool with agent in backend/agents/chat_agent.py
- [ ] T043 [US2] Implement task listing service logic in backend/services/task_service.py
- [ ] T044 [US2] Add task listing validation and filtering in backend/schemas/task.py
- [ ] T045 [US2] Update ChatKit UI to display task lists in frontend/src/app/chat/page.tsx
- [ ] T046 [US2] Enhance frontend API client for task listing in frontend/src/lib/api.ts
- [ ] T047 [US2] Test natural language processing for task listing
- [ ] T048 [US2] Test user authentication and authorization for task listing
- [ ] T049 [US2] Test task filtering by status (all, pending, completed)

---

## Phase 5: User Story 3 - Updating Tasks

### Goal
Enable users to update existing tasks through conversation with the AI assistant using update_task MCP tool.

### User Story
As a user, I can say "Change 'buy groceries' to 'buy milk and eggs'" and the AI assistant will identify the task, use the update_task MCP tool, and confirm "I've updated your task to 'Buy milk and eggs'"

### Independent Test Criteria
- Natural language input for task updates correctly identifies existing task
- AI assistant responds with confirmation of update
- MCP tool properly validates user ownership of task
- Task is updated with new title/description while maintaining user association

### Tasks

- [ ] T055 [US3] Implement update_task MCP tool in backend/mcp_server/tools.py
- [ ] T056 [US3] Enhance chat endpoint to support task updates in backend/api/chat.py
- [ ] T057 [US3] Integrate update_task tool with agent in backend/agents/chat_agent.py
- [ ] T058 [US3] Implement task update service logic in backend/services/task_service.py
- [ ] T059 [US3] Add task update validation in backend/schemas/task.py
- [ ] T060 [US3] Update ChatKit UI to handle task update responses in frontend/src/app/chat/page.tsx
- [ ] T061 [US3] Enhance frontend API client for task updates in frontend/src/lib/api.ts
- [ ] T062 [US3] Test natural language processing for task updates
- [ ] T063 [US3] Test user authentication and authorization for task updates
- [ ] T064 [US3] Test task identification and update validation

---

## Phase 6: User Story 4 - Completing Tasks

### Goal
Enable users to mark tasks as complete through conversation with the AI assistant using complete_task MCP tool.

### User Story
As a user, I can say "Mark 'call mom' as complete" and the AI assistant will use the complete_task MCP tool and confirm "I've marked 'Call mom' as complete"

### Independent Test Criteria
- Natural language input for task completion correctly identifies existing task
- AI assistant responds with confirmation of completion
- MCP tool properly validates user ownership of task
- Task completion status is toggled in database

### Tasks

- [ ] T070 [US4] Implement complete_task MCP tool in backend/mcp_server/tools.py
- [ ] T071 [US4] Enhance chat endpoint to support task completion in backend/api/chat.py
- [ ] T072 [US4] Integrate complete_task tool with agent in backend/agents/chat_agent.py
- [ ] T073 [US4] Implement task completion service logic in backend/services/task_service.py
- [ ] T074 [US4] Add task completion validation in backend/schemas/task.py
- [ ] T075 [US4] Update ChatKit UI to display task completion status in frontend/src/app/chat/page.tsx
- [ ] T076 [US4] Enhance frontend API client for task completion in frontend/src/lib/api.ts
- [ ] T077 [US4] Test natural language processing for task completion
- [ ] T078 [US4] Test user authentication and authorization for task completion
- [ ] T079 [US4] Test task completion state transitions

---

## Phase 7: User Story 5 - Deleting Tasks

### Goal
Enable users to delete tasks through conversation with the AI assistant using delete_task MCP tool, with appropriate confirmation for ambiguous requests.

### User Story
As a user, I can say "Remove the meeting task" and the AI assistant may ask for clarification if multiple tasks match, then use the delete_task MCP tool after confirmation and respond "I've deleted the meeting task"

### Independent Test Criteria
- Natural language input for task deletion correctly identifies existing task
- AI assistant requests clarification when multiple tasks match
- MCP tool properly validates user ownership of task
- Task is removed from database with proper user authentication

### Tasks

- [ ] T085 [US5] Implement delete_task MCP tool in backend/mcp_server/tools.py
- [ ] T086 [US5] Enhance chat endpoint to support task deletion in backend/api/chat.py
- [ ] T087 [US5] Integrate delete_task tool with agent in backend/agents/chat_agent.py
- [ ] T088 [US5] Implement task deletion service logic in backend/services/task_service.py
- [ ] T089 [US5] Add task deletion validation and confirmation logic in backend/schemas/task.py
- [ ] T090 [US5] Update ChatKit UI to handle task deletion responses in frontend/src/app/chat/page.tsx
- [ ] T091 [US5] Enhance frontend API client for task deletion in frontend/src/lib/api.ts
- [ ] T092 [US5] Test natural language processing for task deletion
- [ ] T093 [US5] Test user authentication and authorization for task deletion
- [ ] T094 [US5] Test ambiguous task resolution and confirmation flow

---

## Phase 8: Conversation State Management & History

### Goal
Implement stateless conversation management with database-backed persistence to maintain context between exchanges.

### Independent Test Criteria
- Conversation history is persisted to database
- Server reconstructs context from database for each request
- No in-memory conversation state is maintained
- Conversation history persists across server restarts

### Tasks

- [ ] T100 Implement conversation model and database operations in backend/models.py and backend/services/conversation_service.py
- [ ] T101 Implement message model and database operations in backend/models.py and backend/services/message_service.py
- [ ] T102 Update chat endpoint to load conversation history from database in backend/api/chat.py
- [ ] T103 Update chat endpoint to store user messages in database in backend/api/chat.py
- [ ] T104 Update chat endpoint to store assistant responses in database in backend/api/chat.py
- [ ] T105 Implement conversation history loading in ChatKit UI frontend/src/app/chat/page.tsx
- [ ] T106 Ensure conversation history preservation with ChatKit widgets
- [ ] T107 Test conversation state reconstruction after server restart
- [ ] T108 Test message ordering and timestamp preservation
- [ ] T109 Test conversation history limits and pagination

---

## Phase 9: Pluggable AI Architecture & Gemini Integration

### Goal
Implement abstraction layer for AI providers to support multiple services (OpenAI, Google Gemini) with the same MCP tools interface.

### Independent Test Criteria
- AI provider can be switched without changing MCP tools
- Same MCP tools work with different AI providers
- Conversation flow remains consistent regardless of AI provider
- Performance requirements are met with different AI providers

### Tasks

- [ ] T115 Create AI provider abstraction interface in backend/agents/provider_interface.py
- [ ] T116 Implement OpenAI provider adapter using Agents SDK in backend/agents/providers/openai_provider.py
- [ ] T117 Create Google Gemini provider adapter in backend/agents/providers/gemini_provider.py
- [ ] T118 Update agent orchestrator to use provider abstraction in backend/agents/chat_agent.py
- [ ] T119 Add configuration for AI provider selection in backend/config/ai_config.py
- [ ] T120 Test functionality with OpenAI provider
- [ ] T121 Test functionality with Google Gemini provider
- [ ] T122 Verify MCP tools interface remains consistent across providers
- [ ] T123 Test performance with different AI providers

---

## Phase 10: Error Handling & Security

### Goal
Implement comprehensive error handling and security measures to meet non-functional requirements.

### Independent Test Criteria
- Invalid JWT tokens return 401 error
- Cross-user access attempts return 403 error
- Missing tasks return 404 error
- Validation errors return 422 error
- No sensitive data is exposed in chat responses
- Prompt injection attempts are properly handled

### Tasks

- [ ] T130 Implement comprehensive error handling in backend/api/chat.py
- [ ] T131 Add cross-user data access prevention in MCP tools in backend/mcp_server/tools.py
- [ ] T132 Implement prompt injection protection in backend/agents/chat_agent.py
- [ ] T133 Add input sanitization for all user inputs in backend/schemas/
- [ ] T134 Implement proper error responses (401, 403, 404, 422) in backend/api/chat.py
- [ ] T135 Add security headers and protections in backend/middleware/
- [ ] T136 Test error handling for all user stories
- [ ] T137 Test security measures against unauthorized access
- [ ] T138 Test prompt injection protection scenarios

---

## Phase 11: Testing & Quality Assurance

### Goal
Implement comprehensive testing to ensure all functionality works as specified.

### Independent Test Criteria
- Unit tests cover all MCP tool functions (add, list, update, delete, complete)
- Integration tests verify AI agent interaction with MCP tools
- End-to-end tests validate complete conversation flows
- Authentication tests confirm user isolation
- Error handling tests verify proper responses for invalid inputs and missing tasks

### Tasks

- [ ] T145 Create unit tests for add_task MCP tool in backend/tests/test_add_task.py
- [ ] T146 Create unit tests for list_tasks MCP tool in backend/tests/test_list_tasks.py
- [ ] T147 Create unit tests for update_task MCP tool in backend/tests/test_update_task.py
- [ ] T148 Create unit tests for delete_task MCP tool in backend/tests/test_delete_task.py
- [ ] T149 Create unit tests for complete_task MCP tool in backend/tests/test_complete_task.py
- [ ] T150 Create integration tests for AI agent interaction with MCP tools in backend/tests/test_agent_integration.py
- [ ] T151 Create end-to-end tests for conversation flows in backend/tests/test_e2e.py
- [ ] T152 Create authentication tests for user isolation in backend/tests/test_auth.py
- [ ] T153 Create error handling tests in backend/tests/test_errors.py
- [ ] T154 Create frontend tests for ChatKit UI in frontend/__tests__/chat.test.tsx

---

## Phase 12: Polish & Cross-Cutting Concerns

### Goal
Complete the implementation with performance optimizations, documentation, and deployment preparation.

### Independent Test Criteria
- System responds to user queries within 3 seconds for 95% of requests
- MCP tools execute within 1 second for 95% of operations
- All conversation history is preserved across server restarts
- Users can only access their own tasks (cross-user access prevented 100% of the time)

### Tasks

- [ ] T160 Optimize database queries with proper indexing in backend/db.py
- [ ] T161 Add performance monitoring to chat endpoint in backend/api/chat.py
- [ ] T162 Implement caching for frequently accessed data in backend/services/
- [ ] T163 Add comprehensive logging for debugging in backend/utils/logging.py
- [ ] T164 Create API documentation based on OpenAPI spec in contracts/openapi.yaml
- [ ] T165 Update MCP tools documentation based on spec in contracts/mcp-tools.json
- [ ] T166 Add performance tests to verify response time requirements
- [ ] T167 Create deployment configuration files
- [ ] T168 Final integration testing of all user stories
- [ ] T169 Performance validation and tuning